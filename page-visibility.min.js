!function(i,t,e){var n,s=-1;n={STATE_VISIBLE:"visible",STATE_HIDDEN:"hidden",_visibilityState:{current:void 0,prev:void 0},_isNative:!1,_callbacks:{},isHidden:function(){return n._visibilityState.current===n.STATE_HIDDEN},getVisibilityState:function(){return n._visibilityState},subscribe:function(i){if("function"==typeof i){var t=n._uniqId();return n._callbacks[t]=i,t}},unsubscribe:function(i){n._callbacks[i]&&!n._isDestructing&&delete n._callbacks[i]},isNativelySupported:function(){return n._isNative},_uniqId:function(){return"pageVisibility_"+String(++s)},_onChange:function(i){var s={focus:n.STATE_VISIBLE,focusin:n.STATE_VISIBLE,pageshow:n.STATE_VISIBLE,blur:n.STATE_HIDDEN,focusout:n.STATE_HIDDEN,pagehide:n.STATE_HIDDEN};n._isDestructing||(i=i||t.event,n._visibilityState.prev=n._visibilityState.current,n._visibilityState.current=n.isNativelySupported()?e.webkitVisibilityState||e.visibilityState:i.type in s?s[i.type]:n.STATE_VISIBLE,n._notifySubscribers(i))},_notifySubscribers:function(i){for(var t in n._callbacks)n._callbacks.hasOwnProperty(t)&&n._callbacks[t]&&n._callbacks[t].call(e,i,n._visibilityState)},_init:function(){var i;n._inited||(n._isNative="hidden"in e||"webkitHidden"in e,i=function(){n._onChange.apply(n,arguments)},n._isNative?(n._visibilityState.current=e.webkitVisibilityState||e.visibilityState,e.addEventListener(("webkitHidden"in e?"webkit":"")+"visibilitychange",i)):"onfocusin"in e?(e.attachEvent("onfocusin",i),e.attachEvent("onfocusout",i)):(t.addEventListener("focus",i,!0),t.addEventListener("blur",i,!0)),n._inited=!0)}},n._init(),"undefined"!=typeof module&&module.exports?module.exports=n:i.pageVisibility=n}(this,window,document);